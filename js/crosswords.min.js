/**
Copyright (c) 2015-2021, Crossword Nexus
https://opensource.org/licenses/BSD-3-Clause
**/
!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e(t):e(t,!0)}("undefined"!=typeof window?window:this,function(t,e){"use strict";var i,s={hover_enabled:!1,settings_enabled:!0,color_hover:"#FFFFAA",color_selected:"#FF0000",color_word:"#FFFF00",color_hilite:"#FFFCA5",color_none:"#FFFFFF",color_block:"#000000",cell_size:null,puzzle_file:null,puzzles:null,skip_filled_letters:!0,savegame_name:""},o="jpz",l="puz",r=1,c=3,n="lib/zip",h="Error loading file",d="Failed to unzip file",a="Error parsing JPZ file... Not JPZ or zipped JPZ file.",u=!1,p=["crossword","coded","acrostic"],_=0;function v(t,e){var i=new XMLHttpRequest,s=$.Deferred();return i.open("GET",t),i.responseType="blob",i.onload=function(){200==i.status?w(i.response,e,s):s.reject(h)},i.send(),s}var g,f=("draggable"in(g=document.createElement("div"))||"ondragstart"in g&&"ondrop"in g)&&"FormData"in t&&"FileReader"in t;function w(t,e,i){var s=new FileReader;return i=i||$.Deferred(),s.onload=function(s){var r=s.target.result;e===o?r.match(/^<\?xml/)?m(s.target.result,i):function(t,e,i){zip.workerScripts={inflater:[n+"/z-worker.js",n+"/inflate.js"]},zip.createReader(t,function(t){t.getEntries(function(t){t.length&&t[0].getData(new zip.TextWriter,function(t){"function"==typeof e&&e(t,i)})})},function(t){i.reject(d)})}(new zip.TextReader(t),m,i):e===l&&i.resolve(r)},e===l?s.readAsBinaryString(t):s.readAsText(t),i}function m(e,i){var s;e=e.replace("&nbsp;"," "),t.DOMParser?s=(new DOMParser).parseFromString(e,"text/xml"):((s=new ActiveXObject("Microsoft.XMLDOM")).async=!1,s.loadXML(e)),s.getElementsByTagName("parsererror").length?i.reject(a):i.resolve(s)}function b(t){var e,i,s,o=t.childNodes,l="";for(e=0;i=o[e];e++)i.nodeType===c&&(l+=i.textContent),i.nodeType===r&&(l+="<"+(s=i.nodeName)+">"+b(i)+"</"+s+">");return l}function y(t){return null==t?null:t.charAt(0)}var x={createCrossword:function(t,e){var i;try{if("undefined"==typeof jQuery)throw new Error("jQuery not found");if("undefined"==typeof zip)throw new Error("Zip js not found");if("undefined"==typeof PUZAPP)throw new Error("Puz js not found");e&&e.hasOwnProperty("zipjs_path")&&(n=e.zipjs_path),i=new z(t,e)}catch(t){alert(t.message)}return i}},z=function(t,e){this.parent=t,this.config={};var i,o={};try{JSON.parse(localStorage.getItem("crossword_nexus_settings"))}catch(t){console.log(t)}for(i in s)s.hasOwnProperty(i)&&(o&&o.hasOwnProperty(i)?this.config[i]=o[i]:e&&e.hasOwnProperty(i)?this.config[i]=e[i]:this.config[i]=s[i]);this.cell_size=40,this.top_text_height=0,this.bottom_text_height=0,this.grid_width=0,this.grid_height=0,this.cells={},this.words={},this.clues_top=null,this.clues_bottom=null,this.active_clues=null,this.inactive_clues=null,this.hovered_x=null,this.hovered_y=null,this.selected_word=null,this.hilited_word=null,this.selected_cell=null,this.settings_open=!1,this.timer_running=!1,this.msg_solved="Crossword solved! Congratulations!",this.render_cells_callback=$.proxy(this.renderCells,this),this.init()};z.prototype.init=function(){var t=$.proxy(this.parseJPZPuzzle,this),e=$.proxy(this.parsePUZPuzzle,this),i=$.proxy(this.error,this);function s(s){s[0].name.endsWith(".puz")?w(s[0],l).then(e,i):w(s[0],o).then(t,i)}if(this.root&&this.remove(),this.root=$('<div class="cw-main auto normal"><div class="cw-open-holder"><div class="cw-overflow"></div><div class="cw-open-puzzle"><div class="cw-text">Select puzzle</div><div class="cw-puzzles-list"></div><div class="cw-text">or</div><div class="cw-open-button"></div></div><input type="file" class="cw-open-jpz" accept=".puz,.xml,.jpz,.xpz"></div><div class="cw-notepad-icon"><span class="cwtooltip">Notepad</span></div><div class="cw-settings-icon"><span class="cwtooltip">Settings</span></div><div class="cw-settings"><div class="cw-settings-overflow"></div><div class="cw-settings-background"></div><div class="cw-option cw-color-hover"><span class="cw-option-text">Hovered</span><input class="cw-input-color" type="text"><span class="cw-color-preview"></span></div><div class="cw-option cw-color-selected"><span class="cw-option-text">Selected</span><input class="cw-input-color" type="text"><span class="cw-color-preview"></span></div><div class="cw-option cw-color-word"><span class="cw-option-text">Word</span><input class="cw-input-color" type="text"><span class="cw-color-preview"></span></div><div class="cw-option cw-color-hilite"><span class="cw-option-text">Hilite</span><input class="cw-input-color" type="text"><span class="cw-color-preview"></span></div><div class="cw-option cw-cell-size"><span class="cw-option-text">Size</span><input class="cw-input-size" type="text"><label><input type="checkbox">Auto</label></div><div class="cw-option cw-skip-filled"><label><input type="checkbox">Skip filled letters</label></div><button>Ok</button></div><div class="cw-top-text"></div><div class="cw-full-height"></div><input type="text" class="cw-hidden-input"><div class="cw-canvas"><canvas></canvas></div><div class="cw-bottom-text"></div><div class="cw-right"><div class="cw-buttons-holder"><div class="cw-button cw-file">File<div class="cw-file-buttons"><div class="cw-button cw-save">Save</div><div class="cw-button cw-load">Load</div><div class="cw-button cw-print">Print</div></div></div><div class="cw-button cw-check">Check<div class="cw-check-buttons"><div class="cw-button cw-check-letter">Letter</div><div class="cw-button cw-check-word">Word</div><div class="cw-button cw-check-puzzle">Puzzle</div></div></div><div class="cw-button cw-reveal">Reveal<div class="cw-reveal-buttons"><div class="cw-button cw-reveal-letter">Letter</div><div class="cw-button cw-reveal-word">Word</div><div class="cw-button cw-reveal-puzzle">Puzzle</div></div></div><div class="cw-button cw-timer">00:00</div></div><div class="cw-clues-holder"><div class="cw-clues cw-clues-top"><div class="cw-clues-title"></div><div class="cw-clues-items"></div></div><div class="cw-clues cw-clues-bottom"><div class="cw-clues-title"></div><div class="cw-clues-items"></div></div></div></div></div>'),this.top_text=this.root.find("div.cw-top-text"),this.bottom_text=this.root.find("div.cw-bottom-text"),this.clues_holder=this.root.find("div.cw-clues-holder"),this.clues_top_container=this.root.find("div.cw-clues-top"),this.clues_bottom_container=this.root.find("div.cw-clues-bottom"),this.canvas_holder=this.root.find("div.cw-canvas"),this.canvas=this.root.find("canvas"),this.context=this.canvas[0].getContext("2d"),this.settings_icon=this.root.find("div.cw-settings-icon"),this.settings=this.root.find("div.cw-settings"),this.config.settings_enabled?(this.settings_overflow=this.root.find("div.cw-settings-overflow"),this.settings_submit=this.root.find("div.cw-settings button")):(this.settings_icon.remove(),this.settings.remove()),this.notepad_icon=this.root.find("div.cw-notepad-icon"),this.hidden_input=this.root.find("input.cw-hidden-input"),this.reveal_button=this.root.find("div.cw-buttons-holder div.cw-reveal"),this.reveal_letter=this.root.find("div.cw-buttons-holder div.cw-reveal-letter"),this.reveal_word=this.root.find("div.cw-buttons-holder div.cw-reveal-word"),this.reveal_puzzle=this.root.find("div.cw-buttons-holder div.cw-reveal-puzzle"),this.check_button=this.root.find("div.cw-buttons-holder div.cw-check"),this.check_letter=this.root.find("div.cw-buttons-holder div.cw-check-letter"),this.check_word=this.root.find("div.cw-buttons-holder div.cw-check-word"),this.check_puzzle=this.root.find("div.cw-buttons-holder div.cw-check-puzzle"),this.file_button=this.root.find("div.cw-buttons-holder div.cw-file"),this.save_btn=this.root.find("div.cw-buttons-holder div.cw-save"),this.load_btn=this.root.find("div.cw-buttons-holder div.cw-load"),this.print_btn=this.root.find("div.cw-buttons-holder div.cw-print"),this.timer_button=this.root.find("div.cw-buttons-holder div.cw-timer"),this.config.puzzle_file&&this.config.puzzle_file.hasOwnProperty("url")&&this.config.puzzle_file.hasOwnProperty("type")){var r;switch(this.root.addClass("loading"),this.config.puzzle_file.type){case o:r=t;break;case l:r=e}v(this.config.puzzle_file.url,this.config.puzzle_file.type).then(r,i)}else{var c,n,h,d=this.root.find("div.cw-open-puzzle"),a=this.root.find("div.cw-puzzles-list"),u=0;if(this.config.puzzles&&this.config.puzzles.length)for(c=0;n=this.config.puzzles[c];c++)(h=$("<span>"+n.name+"</span>")).data("url",n.url),h.data("type",n.type),a.append(h),u++;if(u?d.delegate("div.cw-puzzles-list span","click",function(s){var r,c=$(s.currentTarget),n=c.data("url"),h=c.data("type");h===o?r=t:h===l&&(r=e),r&&v(n,h).then(r,i)}):d.addClass("empty"),this.open_button=this.root.find("div.cw-open-button"),this.file_input=this.root.find('input[type="file"]'),this.open_button.on("click",function(t){this.file_input.click()}.bind(this)),this.file_input.on("change",function(){var t=this.file_input[0].files.length?this.file_input[0].files:null;t&&s(t)}.bind(this)),f){var p=this.root.find("div.cw-overflow");p.addClass("has-advanced-upload");p.on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault(),t.stopPropagation()}).on("dragover dragenter",function(){p.addClass("is-dragover")}).on("dragleave dragend drop",function(){p.removeClass("is-dragover")}).on("drop",function(t){s(t.originalEvent.dataTransfer.files)})}}this.number_to_cells={},this.crossword_type="crossword",this.is_autofill=!1,this.root.appendTo(this.parent)},z.prototype.error=function(t){alert(t)},z.prototype.parsePUZPuzzle=function(t){var e=PUZAPP.parsepuz(t);if(this.title="",this.author="",this.copyright="",this.crossword_type="crossword",e.title.length){this.title=e.title;var i=this.title;e.author.length&&(this.author=e.author,i+="<br>"+this.author),e.copyright.length&&(this.copyright=e.copyright,i+="<br>"+this.copyright),this.bottom_text.html(i)}this.notepad=e.notes,this.notepad||this.notepad_icon.remove(),this.grid_width=e.width,this.grid_height=e.height,this.cells={};for(var s=0;s<e.width;s++)for(var o=0;o<e.height;o++){this.cells[s+1]||(this.cells[s+1]={});var l=o*e.width+s,r=e.solution.charAt(l),c=e.circles[l]?"circle":null;this.cells[s+1][o+1]={x:s+1,y:o+1,solution:"."!=r?r:null,number:e.sqNbrs[l],color:null,shape:c,empty:"."==r,letter:null}}var n=Object.keys(e.across_clues).map(function(t){return{word:(1e3+parseInt(t)).toString(),number:t.toString(),text:e.across_clues[t]}});this.clues_top=new k(this,{id:"clues_top",title:"<b>Across</b>",clues:n,words_ids:Object.keys(e.across_clues).map(function(t){return(1e3+parseInt(t)).toString()})});var h=Object.keys(e.down_clues).map(function(t){return{word:(2e3+parseInt(t)).toString(),number:t.toString(),text:e.down_clues[t]}});this.clues_bottom=new k(this,{id:"clues_bottom",title:"<b>Down</b>",clues:h,words_ids:Object.keys(e.down_clues).map(function(t){return(2e3+parseInt(t)).toString()})});var d={};for(s=0;s<e.width;s++)for(o=0;o<e.height;o++){var a=e.acrossWordNbrs[o*e.width+s];0!=a&&(d[1e3+a]||(d[1e3+a]=[]),d[1e3+a].push({x:(s+1).toString(),y:(o+1).toString()}));var u=e.downWordNbrs[o*e.width+s];0!=u&&(d[2e3+u]||(d[2e3+u]=[]),d[2e3+u].push({x:(s+1).toString(),y:(o+1).toString()}))}this.words={};for(var p=0;p<e.acrossSqNbrs.length;p++){var _=(1e3+e.acrossSqNbrs[p]).toString();this.words[_]=new C(this,{id:_,cell_ranges:d[_],clue:n[p]})}for(p=0;p<e.downSqNbrs.length;p++){_=(2e3+e.downSqNbrs[p]).toString();this.words[_]=new C(this,{id:_,cell_ranges:d[_],clue:h[p]})}this.completeLoad()},z.prototype.parseJPZPuzzle=function(t){var e,i,s,o,l,r;if((i=t.getElementsByTagName("rectangular-puzzle")).length){for(var c=0;c<p.length&&(this.crossword_type=p[c],!((e=t.getElementsByTagName(this.crossword_type)).length>0));c++);if("acrostic"!=this.crossword_type&&"coded"!=this.crossword_type||(this.is_autofill=!0),e.length)if((s=i[0].getElementsByTagName("metadata")).length){var n=t.getElementsByTagName("applet-settings");if(n.length){var h,d=0,u=[["reveal-word","div.cw-reveal-word"],["reveal-letter","div.cw-reveal-letter"],["solution","div.cw-reveal-puzzle"]],_=$();for(h=0;h<u.length;h++){if(!n[0].getElementsByTagName(u[h][0]).length){d+=1;var v=u[h][1];_=_.add(v)}}_.css({display:"none"}),3==d&&$("div.cw-reveal").css({display:"none"})}if(o=s[0].getElementsByTagName("title"),l=s[0].getElementsByTagName("creator"),r=s[0].getElementsByTagName("copyright"),this.title="",this.author="",this.copyright="",o.length){this.title=b(o[0]);var g=this.title;l.length&&(this.author=b(l[0]),g+="<br>"+this.author),r.length&&(this.copyright=b(r[0]),g+="<br>"+this.copyright),this.bottom_text.html(g)}var f=s[0].getElementsByTagName("description");f=f.length?b(f[0]):"";var w=t.getElementsByTagName("completion");w.length&&(this.msg_solved=b(w[0])),this.parseJPZCrossWord(e[0],f)}else this.error(a);else this.error("Error opening file. Probably not a crossword.")}else this.error(a)},z.prototype.parseJPZCrossWord=function(t,e){var i,s,o,l,r=t.getElementsByTagName("grid")[0],c=r.getElementsByTagName("grid-look")[0],n=r.getElementsByTagName("cell"),h=t.getElementsByTagName("word"),d=t.getElementsByTagName("clues");for(this.grid_width=Number(r.getAttribute("width")),this.grid_height=Number(r.getAttribute("height")),this.cell_size=c.getAttribute("cell-size-in-pixels"),this.notepad=e,this.notepad||this.notepad_icon.remove(),i=0;s=n[i];i++){var a={x:Number(s.getAttribute("x")),y:Number(s.getAttribute("y")),solution:s.getAttribute("solution"),number:s.getAttribute("number"),color:s.getAttribute("background-color"),shape:s.getAttribute("background-shape"),empty:"block"===s.getAttribute("type")||"void"===s.getAttribute("type")||"clue"===s.getAttribute("type"),letter:s.getAttribute("solve-state"),top_right_number:s.getAttribute("top-right-number"),is_void:"void"===s.getAttribute("type"),clue:"clue"===s.getAttribute("type"),value:s.textContent};this.number_to_cells[a.number]?this.number_to_cells[a.number].push(a):this.number_to_cells[a.number]=[a],(s.getAttribute("top-bar")||s.getAttribute("bottom-bar")||s.getAttribute("left-bar")||s.getAttribute("right-bar"))&&(a.bar={top:"true"===s.getAttribute("top-bar"),bottom:"true"===s.getAttribute("bottom-bar"),left:"true"===s.getAttribute("left-bar"),right:"true"===s.getAttribute("right-bar")}),this.cells[a.x]||(this.cells[a.x]={}),this.cells[a.x][a.y]=a}for(i=0;o=h[i];i++){var u=new C(this);u.fromJPZ(o),this.words[u.id]=u}if("coded"==this.crossword_type){var p=new k(this,{id:"clues_top",title:"ACROSS",clues:[],words_ids:[]}),_=new k(this,{id:"clues_bottom",title:"DOWN",clues:[],words_ids:[]});for(i=0;o=h[i];i++){var v=o.getAttribute("id");o.getAttribute("x");-1==o.getAttribute("y").indexOf("-")?(p.clues.push({word:v,number:v,text:"--"}),p.words_ids.push(v)):(_.clues.push({word:v,number:v,text:"--"}),_.words_ids.push(v))}this.clues_top=p,this.clues_bottom=_,$("div.cw-right").css({display:"none"}),$("div.cw-main").css({"margin-right":"0px"})}else{if(1==d.length&&($("div.cw-clues-bottom").css({display:"none"}),$("div.cw-clues-top").css({bottom:"0%"})),d.length>2)return void this.error("Wrong number of clues in jpz file");for(i=0;l=d[i];i++){var g=new k(this);g.fromJPZ(l),this.clues_top?(g.id="clues_bottom",this.clues_bottom=g):(g.id="clues_top",this.clues_top=g)}}this.completeLoad()},z.prototype.completeLoad=function(){
/** need to add header stuff here **/
this.changeActiveClues(),this.clues_top&&this.renderClues(this.clues_top,this.clues_top_container),this.clues_bottom&&this.renderClues(this.clues_bottom,this.clues_bottom_container),this.addListeners(),this.root.removeClass("loading"),this.root.addClass("loaded");var t=this.active_clues.getFirstWord();this.setActiveWord(t),this.setActiveCell(t.getFirstCell()),this.adjustPaddings(),this.renderCells()},z.prototype.remove=function(){this.removeListeners(),this.root.remove()},z.prototype.removeGlobalListeners=function(){$(t).off("resize",this.render_cells_callback)},z.prototype.removeListeners=function(){this.removeGlobalListeners(),this.clues_holder.undelegate("div.cw-clues-items span"),this.canvas.off("mousemove click"),this.reveal_button.off("click mouseenter mouseleave"),this.reveal_letter.off("click"),this.reveal_word.off("click"),this.reveal_puzzle.off("click"),this.check_button.off("click mouseenter mouseleave"),this.check_letter.off("click"),this.check_word.off("click"),this.check_puzzle.off("click"),this.file_button.off("click mouseenter mouseleave"),this.save_btn.off("click"),this.load_btn.off("click"),this.print_btn.off("click"),this.timer_button.off("click"),this.config.settings_enabled&&(this.settings_icon.off("click"),this.settings_overflow.off("click"),this.settings_submit.off("click"),this.settings.undelegate("div.cw-option input.cw-input-color"),this.settings.undelegate("div.cw-cell-size input[type=checkbox]")),this.notepad_icon.off("click"),this.hidden_input.off("input"),this.hidden_input.off("keydown")},z.prototype.addListeners=function(){$(t).on("resize",this.render_cells_callback),this.clues_holder.delegate("div.cw-clues-items div.cw-clue","mouseenter",$.proxy(this.mouseEnteredClue,this)),this.clues_holder.delegate("div.cw-clues-items div.cw-clue","mouseleave",$.proxy(this.mouseLeftClue,this)),this.clues_holder.delegate("div.cw-clues-items div.cw-clue","click",$.proxy(this.clueClicked,this)),this.config.hover_enabled&&this.canvas.on("mousemove",$.proxy(this.mouseMoved,this)),this.canvas.on("click",$.proxy(this.mouseClicked,this)),this.reveal_button.on("click",$.proxy(this.toggleReveal,this)),this.reveal_button.on("mouseenter",$.proxy(this.openReveal,this)),this.reveal_button.on("mouseleave",$.proxy(this.closeReveal,this)),this.reveal_letter.on("click",$.proxy(this.check_reveal,this,"letter","reveal")),this.reveal_word.on("click",$.proxy(this.check_reveal,this,"word","reveal")),this.reveal_puzzle.on("click",$.proxy(this.check_reveal,this,"puzzle","reveal")),this.check_button.on("click",$.proxy(this.toggleCheck,this)),this.check_button.on("mouseenter",$.proxy(this.openCheck,this)),this.check_button.on("mouseleave",$.proxy(this.closeCheck,this)),this.check_letter.on("click",$.proxy(this.check_reveal,this,"letter","check")),this.check_word.on("click",$.proxy(this.check_reveal,this,"word","check")),this.check_puzzle.on("click",$.proxy(this.check_reveal,this,"puzzle","check")),this.file_button.on("click",$.proxy(this.toggleFile,this)),this.file_button.on("mouseenter",$.proxy(this.openFile,this)),this.file_button.on("mouseleave",$.proxy(this.closeFile,this)),this.save_btn.on("click",$.proxy(this.savePuzzle,this)),this.load_btn.on("click",$.proxy(this.loadPuzzle,this)),this.print_btn.on("click",$.proxy(this.printPuzzle,this)),this.timer_button.on("click",$.proxy(this.toggleTimer,this)),this.config.settings_enabled&&(this.settings_icon.on("click",$.proxy(this.openSettings,this)),this.settings_overflow.on("click",$.proxy(this.closeSettings,this)),this.settings_submit.on("click",$.proxy(this.saveSettings,this)),this.settings.delegate("div.cw-option input.cw-input-color","input",$.proxy(this.settingChanged,this)),this.settings.delegate("div.cw-cell-size input[type=checkbox]","change",$.proxy(this.settingSizeAuto,this))),this.notepad&&this.notepad_icon.on("click",$.proxy(this.showNotepad,this)),this.hidden_input.on("input",$.proxy(this.hiddenInputChanged,this,null)),this.hidden_input.on("keydown",$.proxy(this.keyPressed,this))},z.prototype.changeActiveClues=function(){if(this.clues_bottom)this.active_clues&&"clues_top"===this.active_clues.id?null!==this.inactive_clues&&(this.active_clues=this.clues_bottom,this.inactive_clues=this.clues_top):(this.active_clues=this.clues_top,this.inactive_clues=this.clues_bottom);else if(this.active_clues=this.clues_top,this.inactive_clues=this.clues_top,this.selected_cell){var t=this.active_clues.getMatchingWord(this.selected_cell.x,this.selected_cell.y,!0);this.setActiveWord(t)}},z.prototype.getCell=function(t,e){return this.cells[t]?this.cells[t][e]:null},z.prototype.setActiveWord=function(t){t&&(this.selected_word=t,this.top_text.html('<span class="cw-clue-number">'+t.clue.number+'.</span><span class="cw-clue-text">'+t.clue.text+"</span>"))},z.prototype.setActiveCell=function(t){var e,i,s=this.canvas.offset();t&&!t.empty&&(this.selected_cell=t,this.active_clues.markActive(t.x,t.y,!1),this.inactive_clues.markActive(t.x,t.y,!0),e=s.top+(t.y-1)*this.cell_size,i=s.left+(t.x-1)*this.cell_size,this.hidden_input.css({left:i,top:e}),this.hidden_input.focus())},z.prototype.renderClues=function(t,e){var i,s,o,l=e.find("div.cw-clues-title"),r=e.find("div.cw-clues-items");for(r.find("div.cw-clue").remove(),i=0;s=t.clues[i];i++)(o=$('<div><span class="cw-clue-number">'+s.number+'</span><span class="cw-clue-text">'+s.text+"</span></div>")).data("word",s.word),o.data("number",s.number),o.data("clues",t.id),o.addClass("cw-clue"),o.addClass("word-"+s.word),r.append(o);l.html(t.title),t.clues_container=r},z.prototype.renderCells=function(){var e,i;if(this.adjustSize(),0===Number(this.config.cell_size)){this.root.removeClass("fixed"),this.root.addClass("auto");$(".cw-canvas").get(0).getBoundingClientRect();const t=this.root.height()-(this.top_text_height+this.bottom_text_height)-6,e=this.root.width()-16;this.cell_size=Math.min(Math.floor(t/this.grid_height),Math.floor(e/this.grid_width))}else this.root.removeClass("auto"),this.root.addClass("fixed"),this.cell_size=Number(this.config.cell_size);var s=this.grid_width*this.cell_size-1+6,o=this.grid_height*this.cell_size-1+6,l=t.devicePixelRatio||1;for(e in this.canvas[0].width=l*s,this.canvas[0].height=l*o,this.canvas[0].style.width=s+"px",this.canvas[0].style.height=o+"px",this.context.scale(l,l),this.context.fillStyle=this.config.color_block,this.context.fillRect(0,0,this.canvas[0].width,this.canvas[0].height),this.cells)for(i in this.cells[e]){var r=this.cells[e][i],c=(e-1)*this.cell_size+3,n=(i-1)*this.cell_size+3;if(r.empty)r.is_void||r.clue?this.context.fillStyle=this.config.color_none:this.context.fillStyle=r.color||this.config.color_block,this.context.fillRect(c,n,this.cell_size,this.cell_size),this.context.fillStyle=this.config.color_block;else{var h=r.color||this.config.color_none;this.hilited_word&&this.hilited_word.hasCell(r.x,r.y)&&(h=this.config.color_hilite),this.selected_word&&this.selected_word.hasCell(r.x,r.y)&&(h=this.config.color_word),this.config.hover_enabled&&e==this.hovered_x&&i==this.hovered_y&&(h=this.config.color_hover),this.selected_cell&&e==this.selected_cell.x&&i==this.selected_cell.y&&(h=this.config.color_selected),this.context.fillStyle=this.config.color_block,this.context.fillRect(c,n,this.cell_size,this.cell_size),"acrostic"==this.crossword_type&&r.number==this.selected_cell.number&&r!=this.selected_cell&&(h=this.config.color_hilite),this.context.fillStyle=h,this.context.fillRect(c,n,this.cell_size-1,this.cell_size-1),this.context.fillStyle=this.config.color_block,e>0&&i>0&&(this.context.beginPath(),this.context.lineWidth=1,this.context.moveTo(c,n),this.context.lineTo(c,n+this.cell_size),this.context.stroke(),this.context.beginPath(),this.context.moveTo(c,n),this.context.lineTo(c+this.cell_size,n),this.context.stroke())}if("circle"===r.shape){var d=c+(this.cell_size-1)/2,a=n+(this.cell_size-1)/2,u=(this.cell_size-1)/2;this.context.beginPath(),this.context.arc(d,a,u,0,2*Math.PI,!1),this.context.stroke()}if(r.bar){var p={top:[c,n],left:[c,n],right:[c+this.cell_size,n+this.cell_size],bottom:[c+this.cell_size,n+this.cell_size]},_={top:[c+this.cell_size,n],left:[c,n+this.cell_size],right:[c+this.cell_size,n],bottom:[c,n+this.cell_size]};for(var v in r.bar)r.bar.hasOwnProperty(v)&&r.bar[v]&&(this.context.beginPath(),this.context.moveTo(p[v][0],p[v][1]),this.context.lineTo(_[v][0],_[v][1]),this.context.lineWidth=5,this.context.stroke(),this.context.lineWidth=1)}if(r.number&&(this.context.font=Math.ceil(this.cell_size/4)+"px sans-serif",this.context.textAlign="left",this.context.textBaseline="top",this.context.fillText(r.number,Math.floor(c+.1*this.cell_size),Math.floor(n+.1*this.cell_size))),r.top_right_number&&(this.context.font=Math.ceil(this.cell_size/4)+"px sans-serif",this.context.textAlign="right",this.context.textBaseline="top",this.context.fillText(r.top_right_number,Math.floor(c+.9*this.cell_size),Math.floor(n+.1*this.cell_size))),r.letter){var g=r.letter.length;this.context.font=this.cell_size/(1.1+.5*g)+"px sans-serif",r.revealed&&(this.context.font="bold italic "+this.context.font),r.checked&&(this.context.beginPath(),this.context.moveTo(c,n),this.context.lineTo(c+this.cell_size,n+this.cell_size),this.context.stroke()),this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(r.letter,c+this.cell_size/2,n+2*this.cell_size/3)}}},
/** all of this disappears when we move to a more modern approach to resizing **/
z.prototype.adjustSize=function(){var t=this.root.outerWidth(!0);t>=700&&!this.root.hasClass("big")?(this.root.addClass("big"),this.root.removeClass("normal small tiny"),this.adjustPaddings()):t<700&&t>=580&&!this.root.hasClass("normal")?(this.root.addClass("normal"),this.root.removeClass("big small tiny"),this.adjustPaddings()):t<580&&t>=450&&!this.root.hasClass("small")?(this.root.addClass("small"),this.root.removeClass("big normal tiny"),this.adjustPaddings()):t<450&&t<450&&!this.root.hasClass("tiny")&&(this.root.addClass("tiny"),this.root.removeClass("big normal small"),this.adjustPaddings())},z.prototype.adjustPaddings=function(){this.top_text_height=this.top_text.outerHeight(!0),this.bottom_text_height=this.bottom_text.outerHeight(!0),this.canvas_holder.css({"padding-top":this.top_text_height,"padding-bottom":this.bottom_text_height})},z.prototype.mouseMoved=function(t){if(this.config.hover_enabled){var e=this.canvas.offset(),i=t.pageX-e.left,s=t.pageY-e.top,o=Math.ceil(i/this.cell_size),l=Math.ceil(s/this.cell_size);o===this.hovered_x&&l===this.hovered_y||(this.hovered_x=o,this.hovered_y=l,this.renderCells())}},z.prototype.mouseClicked=function(t){var e=this.canvas.offset(),i=t.pageX-e.left,s=t.pageY-e.top,o=Math.ceil(i/this.cell_size),l=Math.ceil(s/this.cell_size);this.selected_cell&&this.selected_cell.x==o&&this.selected_cell.y==l&&this.changeActiveClues(),this.active_clues.getMatchingWord(o,l)?this.setActiveWord(this.active_clues.getMatchingWord(o,l)):this.setActiveWord(this.inactive_clues.getMatchingWord(o,l)),this.setActiveCell(this.getCell(o,l)),this.renderCells()},z.prototype.keyPressed=function(t){if(!this.settings_open){var e=[35,36,37,38,39,40,32,46,8,9,13].indexOf(t.keyCode)>=0;switch(t.keyCode){case 35:this.moveToFirstCell(!0);break;case 36:this.moveToFirstCell(!1);break;case 37:t.shiftKey?this.skipToWord("left"):this.moveSelectionBy(-1,0);break;case 38:t.shiftKey?this.skipToWord("up"):this.moveSelectionBy(0,-1);break;case 39:t.shiftKey?this.skipToWord("right"):this.moveSelectionBy(1,0);break;case 40:t.shiftKey?this.skipToWord("down"):this.moveSelectionBy(0,1);break;case 32:if(this.selected_cell&&this.selected_word){this.selected_cell.letter="",this.selected_cell.checked=!1,this.autofill();var i=this.selected_word.getNextCell(this.selected_cell.x,this.selected_cell.y);this.setActiveCell(i)}this.renderCells();break;case 27:case 45:if(this.selected_cell&&this.selected_word){var s=prompt("Rebus entry","");this.hiddenInputChanged(s)}break;case 46:this.selected_cell&&(this.selected_cell.letter="",this.selected_cell.checked=!1,this.autofill()),this.renderCells();break;case 8:if(this.selected_cell&&this.selected_word){this.selected_cell.letter="",this.selected_cell.checked=!1,this.autofill();var o=this.selected_word.getPreviousCell(this.selected_cell.x,this.selected_cell.y);this.setActiveCell(o)}this.renderCells();break;case 9:case 13:t.shiftKey?this.moveToNextWord(!0):this.moveToNextWord(!1)}e&&(t.preventDefault(),t.stopPropagation())}},z.prototype.autofill=function(){if(this.is_autofill){var t=this.selected_cell.number,e=this.number_to_cells[t]||[];for(var i of e){var s=this.cells[i.x][i.y];s.letter=this.selected_cell.letter,s.checked=this.selected_cell.checked}}},z.prototype.hiddenInputChanged=function(t){var e,i=this.hidden_input.val().slice(0,1).toUpperCase();this.selected_word&&this.selected_cell&&(i?this.selected_cell.letter=i:t&&(this.selected_cell.letter=t.toUpperCase()),this.selected_cell.checked=!1,this.autofill(),e=this.config.skip_filled_letters&&this.selected_word.getFirstEmptyCell(this.selected_cell.x,this.selected_cell.y)||this.selected_word.getNextCell(this.selected_cell.x,this.selected_cell.y),this.setActiveCell(e),this.renderCells(),this.checkIfSolved()),this.hidden_input.val("")},z.prototype.checkIfSolved=function(){var t,e,s;for(t in this.cells)for(e in this.cells[t])if(!((s=this.cells[t][e]).empty||s.letter&&y(s.letter)==y(s.solution)))return;this.timer_running&&(clearTimeout(i),this.timer_button.removeClass("running"),this.timer_running=!1),alert(this.msg_solved)},z.prototype.skipToWord=function(t){if(this.selected_cell&&this.selected_word){var e,i,s,o=this.selected_cell.x,l=this.selected_cell.y,r=function(t){return!(!t||t.empty||!(i=this.active_clues.getMatchingWord(t.x,t.y))||i.id===this.selected_word.id)&&(s=i.getFirstEmptyCell()||i.getFirstCell(),this.setActiveWord(i),this.setActiveCell(s),this.renderCells(),!0)}.bind(this);switch(t){case"up":for(e=l-1;e>=0;e--)if(r(this.getCell(o,e)))return;break;case"down":for(e=l+1;e<=this.grid_height;e++)if(r(this.getCell(o,e)))return;break;case"left":for(e=o-1;e>=0;e--)if(r(this.getCell(e,l)))return;break;case"right":for(e=o+1;e<=this.grid_width;e++)if(r(this.getCell(e,l)))return}}},z.prototype.moveToNextWord=function(t){if(this.selected_word){var e,i=t?this.active_clues.getPreviousWord(this.selected_word):this.active_clues.getNextWord(this.selected_word);i&&(e=i.getFirstEmptyCell()||i.getFirstCell(),this.setActiveWord(i),this.setActiveCell(e),this.renderCells())}},z.prototype.moveToFirstCell=function(t){if(this.selected_word){var e=t?this.selected_word.getLastCell():this.selected_word.getFirstCell();e&&(this.setActiveCell(e),this.renderCells())}},z.prototype.moveSelectionBy=function(t,e,i){var s,o,l;if(this.selected_cell){if(s=this.selected_cell.x+t,o=this.selected_cell.y+e,!(l=this.getCell(s,o)))return;if(l.empty)return t<0?t--:t>0?t++:e<0?e--:e>0&&e++,void this.moveSelectionBy(t,e,!0);this.selected_word.hasCell(s,o)||(this.inactive_clues.getMatchingWord(this.selected_cell.x,this.selected_cell.y,!0).hasCell(l.x,l.y)&&null!==this.inactive_clues.getMatchingWord(l.x,l.y,!0)&&(this.changeActiveClues(),this.selected_cell.letter||(l=this.selected_cell)),this.setActiveWord(this.active_clues.getMatchingWord(l.x,l.y))),this.setActiveCell(l),this.renderCells()}},z.prototype.mouseEnteredClue=function(t){var e=$(t.currentTarget);this.hilited_word=this.words[e.data("word")],this.renderCells()},z.prototype.mouseLeftClue=function(){this.hilited_word=null,this.renderCells()},z.prototype.clueClicked=function(t){var e=$(t.currentTarget),i=this.words[e.data("word")],s=i.getFirstEmptyCell()||i.getFirstCell();s&&(this.setActiveWord(i),this.active_clues.id!==e.data("clues")&&this.changeActiveClues(),this.setActiveCell(s),this.renderCells())},z.prototype.showNotepad=function(){alert(this.notepad)},z.prototype.openSettings=function(){this.settings.addClass("open"),this.settings.find("div.cw-color-hover input").val(this.config.color_hover),this.settings.find("div.cw-color-hover span.cw-color-preview").css({background:this.config.color_hover}),this.settings.find("div.cw-color-selected input").val(this.config.color_selected),this.settings.find("div.cw-color-selected span.cw-color-preview").css({background:this.config.color_selected}),this.settings.find("div.cw-color-word input").val(this.config.color_word),this.settings.find("div.cw-color-word span.cw-color-preview").css({background:this.config.color_word}),this.settings.find("div.cw-color-hilite input").val(this.config.color_hilite),this.settings.find("div.cw-color-hilite span.cw-color-preview").css({background:this.config.color_hilite}),this.config.cell_size?(this.settings.find("div.cw-cell-size input[type=text]").removeAttr("disabled"),this.settings.find("div.cw-cell-size input[type=text]").val(this.config.cell_size),this.settings.find("div.cw-cell-size input[type=checkbox]").prop("checked",!1)):(this.settings.find("div.cw-cell-size input[type=text]").prop("disabled",!0),this.settings.find("div.cw-cell-size input[type=checkbox]").prop("checked",!0)),this.settings.find("div.cw-skip-filled input[type=checkbox]").prop("checked",this.config.skip_filled_letters),this.settings_open=!0},z.prototype.closeSettings=function(){localStorage.setItem("crossword_nexus_settings","{}"),this.settings.removeClass("open"),this.settings_open=!1,this.hidden_input.focus()},z.prototype.settingChanged=function(t){var e=$(t.currentTarget),i=e.val();i.match(/#[0-9a-fA-F]{6}/)&&e.siblings("span.cw-color-preview").css({background:i})},z.prototype.settingSizeAuto=function(t){var e=$(t.currentTarget),i=e.parent().siblings("input.cw-input-size");e.prop("checked")?(i.prop("disabled",!0),i.val("")):i.removeAttr("disabled")},z.prototype.saveSettings=function(t){var e;(e=this.settings.find("div.cw-color-hover input").val()).match(/#[0-9a-fA-F]{6}/)&&(this.config.color_hover=e),(e=this.settings.find("div.cw-color-selected input").val()).match(/#[0-9a-fA-F]{6}/)&&(this.config.color_selected=e),(e=this.settings.find("div.cw-color-word input").val()).match(/#[0-9a-fA-F]{6}/)&&(this.config.color_word=e),(e=this.settings.find("div.cw-color-hilite input").val()).match(/#[0-9a-fA-F]{6}/)&&(this.config.color_hilite=e),(e=this.settings.find("div.cw-cell-size input[type=checkbox]").prop("checked"))?this.config.cell_size=null:(e=this.settings.find("div.cw-cell-size input.cw-input-size").val(),this.config.cell_size=Math.max(10,Math.min(100,Number(e)))),this.config.skip_filled_letters=this.settings.find("div.cw-skip-filled input[type=checkbox]").prop("checked"),this.closeSettings(),this.renderCells(),this.hidden_input.focus(),t.preventDefault(),t.stopPropagation()},z.prototype.openReveal=function(){this.reveal_button.addClass("open")},z.prototype.closeReveal=function(){this.reveal_button.removeClass("open")},z.prototype.toggleReveal=function(){this.reveal_button.toggleClass("open")},z.prototype.openCheck=function(){this.check_button.addClass("open")},z.prototype.closeCheck=function(){this.check_button.removeClass("open")},z.prototype.toggleCheck=function(){this.check_button.toggleClass("open")},z.prototype.openFile=function(){this.file_button.addClass("open")},z.prototype.closeFile=function(){this.file_button.removeClass("open")},z.prototype.toggleFile=function(){this.file_button.toggleClass("open")},z.prototype.check_reveal=function(t,e,i){var s=[];switch(t){case"letter":this.selected_cell&&(s=[this.selected_cell]);break;case"word":var o;if(this.selected_word)for(n=0;o=this.selected_word.cells[n];n++)(r=this.selected_word.getCellByCoordinates(o))&&s.push(r);break;case"puzzle":var l,r;for(n in this.cells)for(l in this.cells[n])r=this.cells[n][l],s.push(r)}if(this.is_autofill)for(var c=s.length,n=0;n<c;n++){var h=s[n].number;if(null!==h){var d=this.number_to_cells[h]||[];for(var a of d)s.push(this.cells[a.x][a.y])}}for(n=0;n<s.length;n++)y(s[n].letter)!=y(s[n].solution)&&("reveal"==e?(s[n].letter=s[n].solution,s[n].revealed=!0,s[n].checked=!1):"check"==e&&(s[n].checked=!0));this.renderCells(),"reveal"==e?(this.checkIfSolved(),this.closeReveal()):this.closeCheck(),this.hidden_input.focus(),i.preventDefault(),i.stopPropagation()},z.prototype.savePuzzle=function(t){var e,i,s={cell_size:this.cell_size,top_text_height:this.top_text_height,bottom_text_height:this.bottom_text_height,grid_width:this.grid_width,grid_height:this.grid_height,bottom_text:this.bottom_text.html(),top_clues:{id:this.clues_top.id,title:this.clues_top.title,clues:this.clues_top.clues,words_ids:this.clues_top.words_ids},words:{},cells:this.cells};for(e in this.clues_bottom&&(s.bottom_clues={id:this.clues_bottom.id,title:this.clues_bottom.title,clues:this.clues_bottom.clues,words_ids:this.clues_bottom.words_ids}),this.words)this.words.hasOwnProperty(e)&&(s.words[e]={id:this.words[e].id,cell_ranges:this.words[e].cell_ranges,cells:this.words[e].cells,clue:this.words[e].clue});i="crossword_nexus_savegame"+(this.config.savegame_name||""),localStorage.setItem(i,JSON.stringify(s)),alert("Crossword saved"),this.closeFile(),t.preventDefault(),t.stopPropagation()},z.prototype.loadPuzzle=function(t){var e,i,s,o;if(i="crossword_nexus_savegame"+(this.config.savegame_name||""),(s=JSON.parse(localStorage.getItem(i)))&&s.hasOwnProperty("bottom_text")&&s.hasOwnProperty("top_clues")&&s.hasOwnProperty("words")&&s.hasOwnProperty("cells")&&s.hasOwnProperty("cell_size")&&s.hasOwnProperty("top_text_height")&&s.hasOwnProperty("bottom_text_height")&&s.hasOwnProperty("grid_width")&&s.hasOwnProperty("grid_height")){for(e in this.cell_size=s.cell_size,this.top_text_height=s.top_text_height,this.bottom_text_height=s.bottom_text_height,this.grid_width=s.grid_width,this.grid_height=s.grid_height,this.bottom_text.html(s.bottom_text),this.selected_cell=null,this.selected_word=null,this.words={},s.words)s.words.hasOwnProperty(e)&&(this.words[e]=new C(this,s.words[e]));if(this.cells=s.cells,u=!1,this.clues_top=new k(this,s.top_clues),this.clues_bottom=new k(this,s.bottom_clues),u)return void this.error("Error loading savegame - probably corrupted");this.clues_top&&this.renderClues(this.clues_top,this.clues_top_container),this.clues_bottom&&this.renderClues(this.clues_bottom,this.clues_bottom_container),this.active_clues=null,this.inactive_clues=null,this.changeActiveClues(),o=this.active_clues.getFirstWord(),this.setActiveWord(o),this.setActiveCell(o.getFirstCell()),this.renderCells(),alert("Crossword loaded")}else alert("No saved game found");this.closeFile(),t.preventDefault(),t.stopPropagation()},z.prototype.printPuzzle=function(t){if("undefined"!=typeof jsPDF){var e="puzzle.pdf";this.title&&(e=this.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()+".pdf");var i={margin:20,title_pt:null,author_pt:null,copyright_pt:8,num_columns:null,column_padding:10,gray:.4,under_title_spacing:20,max_clue_pt:14,min_clue_pt:5,grid_padding:5,outfile:e,line_width:.3,bar_width:2};i.num_columns||(i.num_columns=this.grid_width>=17?4:3);var s,o=Math.max(i.title_pt,i.author_pt),l=i.margin,r=[];for(var c in this.clues_top.clues)if(this.clues_top.clues.hasOwnProperty(c)){var n=this.clues_top.clues[c].number.toString()+". "+(C=this.clues_top.clues[c].text.replace(/(<([^>]+)>)/gi,"").trim());if(0==c){var h=this.clues_top.title.replace(/(<([^>]+)>)/gi,"").trim();r.push(h+"\n"+n)}else r.push(n)}r.push("");var d=[];if(this.clues_bottom)for(var c in this.clues_bottom.clues)if(this.clues_bottom.clues.hasOwnProperty(c)){n=this.clues_bottom.clues[c].number.toString()+". "+(C=this.clues_bottom.clues[c].text.replace(/(<([^>]+)>)/gi,"").trim());if(0==c){var a=this.clues_bottom.title.replace(/(<([^>]+)>)/gi,"").trim();d.push(a+"\n"+n)}else d.push(n)}for(var u=(612-2*l-(i.num_columns-1)*i.column_padding)/i.num_columns,p=612-2*l-u-i.column_padding,_=612-l-p,v=792-l-p-i.copyright_pt,g=i.max_clue_pt,f=!0;f;){var w=g/3;(s=new jsPDF("portrait","pt","letter")).setFontSize(g),s.setLineWidth(i.line_width);for(var m=l,b=l+o+i.under_title_spacing+g+w,y=0,x=[r,d],z=0;z<x.length;z++){var k=x[z];for(c=0;c<k.length;c++){var C=k[c],P=0==y?792-l-i.copyright_pt:v-i.grid_padding,A=s.splitTextToSize(C,u);if(""!=C||b!=l+o+i.under_title_spacing+g+w){b+(A.length-1)*(g+w)>P&&(y+=1,P=v-i.grid_padding,m=l+y*(u+i.column_padding),b=l+o+i.under_title_spacing+g+w);for(var F=0;F<A.length;F++){0==c&&0==F?s.setFontType("bold"):s.setFontType("normal");var S=A[F];s.text(m,b,S),(b+=g+w)>P&&(m=l+(y+=1)*(u+i.column_padding),b=l+o+i.under_title_spacing+g+w)}}}}g==i.min_clue_pt?f=!1:y>i.num_columns-1?g-=.2:f=!1}
/***********************/if(i.author_pt||(i.author_pt=i.title_pt),!i.title_pt){i.title_pt=12;for(var T=!0;T;){var N=this.title+"asdfasdf"+this.author;s.setFontSize(i.title_pt).setFontType("bold"),1==(A=s.splitTextToSize(N,612)).length?T=!1:i.title_pt-=1}i.author_pt=i.title_pt}var $=l,W=612-l,O=l+o;s.setFontSize(i.title_pt),s.setFontType("bold"),s.text($,O,this.title),s.setFontSize(i.author_pt),s.text(W,O,this.author,null,null,"right"),s.setFontType("normal");var B=612-l,M=792-l;s.setFontSize(i.copyright_pt),s.text(B,M,this.copyright,null,null,"right");var E={grid_letters:!0,grid_numbers:!0,x0:_,y0:v,grid_size:p,gray:i.gray},j=Math.max(this.grid_width,this.grid_height),R=E.grid_size/j;for(var L in this.cells)for(var D in this.cells[L]){var I=this.cells[L][D];if(!I.is_void){c=D-1,F=L-1;var Z=E.x0+F*R,J=E.y0+c*R,q=(this.grid_width,!1),H=I.letter||I.value;I.empty&&!I.clue&&(q=!0,H=""),E.grid_letters||(H="");var U=I.number;E.grid_numbers||(U="");var X=I.top_right_number;K(s,Z,J,R,U,H,q,I.shape,I.color,I.bar,X)}}s.save(i.outfile)}else alert("Printing is disabled.  jsPDF is not defined.  Contact the webmaster.");
/** Function to draw a square **/
function K(t,e,s,o,l,r,c,n,h,d,a){var u=c?"F":"",p=o/20,_=o/3.5;if(h){u="F";var v=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(h);t.setFillColor(v.r,v.g,v.b),t.rect(e,s,o,o,u),t.rect(e,s,o,o,"")}else t.setFillColor(E.gray.toString()),t.rect(e,s,o,o,u);l||(l=""),t.setFontSize(_),t.text(e+p,s+_,l),a||(a=""),t.setFontSize(_),t.text(e+o-_,s+_,a),r||(r="");var g=r.length;if(t.setFontSize(o/(1.5+.5*g)),t.text(e+o/2,s+.8*o,r,null,null,"center"),n&&t.circle(e+o/2,s+o/2,o/2),d){var f={top:[e,s],left:[e,s],right:[e+o,s+o],bottom:[e+o,s+o]},w={top:[e+o,s],left:[e,s+o],right:[e+o,s],bottom:[e,s+o]};for(var m in d)d.hasOwnProperty(m)&&d[m]&&(t.setLineWidth(i.bar_width),t.line(f[m][0],f[m][1],w[m][0],w[m][1]),t.setLineWidth(i.line_width))}}},z.prototype.toggleTimer=function(){var t,e,s=this.timer_button;function o(){var i=((e=((_+=1)-(t=_%60))/60)?e>9?e:"0"+e:"00")+":"+(t>9?t:"0"+t);s.html(i),l()}function l(){i=setTimeout(o,1e3)}this.timer_running?(clearTimeout(i),s.removeClass("running"),this.timer_running=!1,this.hidden_input.focus()):(this.timer_running=!0,s.addClass("running"),this.hidden_input.focus(),l())};var k=function(t,e){this.id="",this.title="",this.clues=[],this.clues_container=null,this.words_ids=[],this.crossword=t,e&&(e.hasOwnProperty("id")&&e.hasOwnProperty("title")&&e.hasOwnProperty("clues")&&e.hasOwnProperty("words_ids")?(this.id=e.id,this.title=e.title,this.clues=e.clues,this.words_ids=e.words_ids):u=!0)};k.prototype.fromJPZ=function(t){var e,i,s=t.getElementsByTagName("title")[0],o=t.getElementsByTagName("clue");for(this.title=b(s),e=0;i=o[e];e++){var l=i.getAttribute("word"),r=this.crossword.words[l],c={word:l,number:i.getAttribute("number"),text:b(i)};this.clues.push(c),r.clue=c,this.words_ids.push(l)}},k.prototype.getFirstWord=function(){return this.words_ids.length?this.crossword.words[this.words_ids[0]]:null},k.prototype.getMatchingWord=function(t,e,i=!1){var s,o,l,r=[];for(s=0;o=this.words_ids[s];s++)(l=this.crossword.words.hasOwnProperty(o)?this.crossword.words[o]:null)&&l.cells.indexOf(t+"-"+e)>=0&&r.push(l);if(1==r.length)return r[0];if(0==r.length)return null;var c=!1;for(s=0;s<r.length;s++)if(l=r[s],i){if(l.id==this.crossword.selected_word.id)c=!0;else if(c)return l}else if(l.id==this.crossword.selected_word.id)return l;return r[0]},k.prototype.markActive=function(t,e,i){var s,o,l,r=i?"passive":"active",c=this.getMatchingWord(t,e);this.clues_container.find("div.cw-clue.active").removeClass("active"),this.clues_container.find("div.cw-clue.passive").removeClass("passive"),c&&((s=this.clues_container.find("div.cw-clue.word-"+c.id)).addClass(r),o=s.position().top,l=s.outerHeight(!0),(o<0||o+l>this.clues_container.height())&&this.clues_container.animate({scrollTop:this.clues_container.scrollTop()+o},150))},k.prototype.getNextWord=function(t){var e=null,i=this.words_ids.indexOf(t.id);return i<this.words_ids.length-1&&(e=this.crossword.words[this.words_ids[i+1]]),e},k.prototype.getPreviousWord=function(t){var e=null,i=this.words_ids.indexOf(t.id);return i>0&&(e=this.crossword.words[this.words_ids[i-1]]),e};var C=function(t,e){this.id="",this.cell_ranges=[],this.cells=[],this.clue={},this.crossword=t,e&&(e.hasOwnProperty("id")&&e.hasOwnProperty("cell_ranges")&&e.hasOwnProperty("clue")?(this.id=e.id,this.cell_ranges=e.cell_ranges,this.clue=e.clue,this.parseRanges()):u=!0)};return C.prototype.fromJPZ=function(t){if(t){var e,i,s=t.getAttribute("id"),o=t.getAttribute("x"),l=t.getAttribute("y");if(this.id=s,o&&l)this.cell_ranges.push({x:o,y:l});else{var r=t.getElementsByTagName("cells");for(e=0;i=r[e];e++)o=i.getAttribute("x"),l=i.getAttribute("y"),this.cell_ranges.push({x:o,y:l})}this.parseRanges()}},C.prototype.parseRanges=function(){var t,e,i;for(this.cells=[],t=0;i=this.cell_ranges[t];t++){var s,o,l,r,c,n,h=i.x.split("-"),d=i.y.split("-");if(h.length>1)for(l=Number(h[0]),r=Number(h[1]),o=d[0],e=l;l<r?e<=r:e>=r;l<r?e++:e--)this.cells.push(e+"-"+o);else if(d.length>1)for(s=h[0],c=Number(d[0]),n=Number(d[1]),e=c;c<n?e<=n:e>=n;c<n?e++:e--)this.cells.push(s+"-"+e);else s=h[0],o=d[0],this.cells.push(s+"-"+o)}},C.prototype.hasCell=function(t,e){return this.cells.indexOf(t+"-"+e)>=0},C.prototype.getFirstEmptyCell=function(t,e){var i,s,o,l=0;for(t&&e&&(l=Math.max(0,this.cells.indexOf(t+"-"+e)))==this.cells.length-1&&(l=0),i=l;o=this.cells[i];i++)if((s=this.getCellByCoordinates(o))&&!s.letter)return s;if(l>0)for(i=0;i<l;i++)if((s=this.getCellByCoordinates(this.cells[i]))&&!s.letter)return s;return null},C.prototype.getFirstCell=function(){var t=null;return this.cells.length&&(t=this.getCellByCoordinates(this.cells[0])),t},C.prototype.getLastCell=function(){var t=null;return this.cells.length&&(t=this.getCellByCoordinates(this.cells[this.cells.length-1])),t},C.prototype.getNextCell=function(t,e){var i=this.cells.indexOf(t+"-"+e),s=null;return i<this.cells.length-1&&(s=this.getCellByCoordinates(this.cells[i+1])),s},C.prototype.getPreviousCell=function(t,e){var i=this.cells.indexOf(t+"-"+e),s=null;return i>0&&(s=this.getCellByCoordinates(this.cells[i-1])),s},C.prototype.getCellByCoordinates=function(t){var e,i,s,o;return 2===(e=t.split("-")).length&&(i=e[0],s=e[1],o=this.crossword.getCell(i,s))?o:null},C.prototype.solve=function(){var t,e,i;for(t=0;e=this.cells[t];t++)(i=this.getCellByCoordinates(e))&&(i.letter=i.solution)},"function"==typeof define&&define.amd&&define("CrosswordNexus",[],function(){return x}),e&&(t.CrosswordNexus=x),x});
Back 
Minify on paste

© 2020 Taufik Nurrohman

No file chosen
